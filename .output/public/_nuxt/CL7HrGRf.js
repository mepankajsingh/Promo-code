import{f,g as q,w as H,h as N,c as g,o as p,b as e,i as M,F as B,r as R,n as I,j as s,t as d,k as W,l as j,v as z,m as L,e as T,p as G,q as J,s as Z,a as K,x as V,y as Q,d as X,_ as Y}from"./BVDDBvT3.js";import{_ as ee}from"./B0bw49uf.js";import{u as O}from"./D4ohb7b9.js";const te={class:"space-y-6"},se={class:"bg-white border border-gray-200 rounded-lg p-6"},oe={class:"border-b border-gray-200 mb-4"},re={class:"flex space-x-4","aria-label":"Region tabs"},ae=["onClick"],ne={class:"grid grid-cols-2 gap-4"},ie={class:"bg-gray-50 p-4 rounded-lg"},de={class:"space-y-2"},le={class:"flex justify-between items-center"},ce={class:"text-sm font-medium text-green-600"},ue={class:"flex justify-between items-center"},me={class:"text-sm font-medium text-blue-600"},xe={class:"bg-gray-50 p-4 rounded-lg"},pe={class:"space-y-2"},ge={class:"flex justify-between items-center"},fe={class:"text-sm font-medium text-green-600"},ye={class:"flex justify-between items-center"},be={class:"text-sm font-medium text-blue-600"},ve={key:0,class:"bg-white border border-gray-200 rounded-lg"},he={class:"p-6 border-b border-gray-200"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},we={class:"flex justify-end"},Ce=["disabled"],ke={class:"p-6 border-b border-gray-200"},Ae={class:"overflow-x-auto"},De={class:"min-w-full divide-y divide-gray-200"},$e={class:"divide-y divide-gray-200"},Me={class:"px-4 py-3 text-sm font-medium text-gray-900"},Se={class:"px-4 py-3 text-sm text-gray-500"},Ee={class:"px-4 py-3 text-sm text-gray-500"},Pe={class:"px-4 py-3 text-sm text-gray-500"},je={class:"px-4 py-3 text-sm text-right"},Ue=["onClick"],Be={class:"bg-white border border-gray-200 rounded-lg p-6"},Re={class:"overflow-x-auto"},Ve={class:"min-w-full divide-y divide-gray-200"},Te={class:"divide-y divide-gray-200"},qe={class:"px-4 py-3 text-sm font-medium text-gray-900"},Ne={class:"px-4 py-3 text-sm text-gray-500"},ze={class:"px-4 py-3 text-sm text-gray-500"},He={class:"px-4 py-3 text-sm text-gray-500"},Le={class:"px-4 py-3 text-sm text-gray-500"},Oe={key:1,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50"},Fe={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},Ie={class:"text-sm text-gray-600 mb-4"},We={class:"font-medium"},Ge={class:"flex justify-end space-x-3"},Je={__name:"PromoCodeManager",props:{userId:{type:String,required:!0}},emits:["code-added","code-deleted"],setup(U,{emit:b}){const n=O(),u=f(!1),v=f([]),y=f([]),m=f("americas"),w=f(!1),h=f(null),i=U,c=q(()=>i.userId==="d38b6b3e-189c-47ce-b6a6-48187d160ebd"),k=[{value:"americas",label:"Americas"},{value:"asia_pacific",label:"Asia Pacific"},{value:"emea",label:"EMEA"}],x=f({code:"",type:"starter",region:"americas"});function A(r){return new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function _(r,t){return y.value.filter(C=>C.type===r&&C.region===t).length}function o(r,t){return v.value.filter(C=>C.type===r&&C.region===t).length}function l(r){h.value=r,w.value=!0}async function S(){if(c){u.value=!0;try{const{error:r}=await n.from("promo_codes").insert([{code:x.value.code,type:x.value.type,region:x.value.region,is_claimed:!1}]);if(r)throw r;x.value={code:"",type:"starter",region:"americas"},await Promise.all([D(),$()]),P("code-added")}catch(r){console.error("Error adding promo code:",r)}finally{u.value=!1}}}async function E(){if(!(!c||!h.value))try{const{error:r}=await n.from("promo_codes").delete().eq("id",h.value.id);if(r)throw r;w.value=!1,h.value=null,await Promise.all([D(),$()]),P("code-deleted")}catch(r){console.error("Error deleting promo code:",r)}}async function D(){try{const{data:r,error:t}=await n.from("user_claims").select(`
        id,
        type,
        region,
        ip_address,
        created_at,
        promo_codes (
          code
        )
      `).order("created_at",{ascending:!1});if(t)throw t;v.value=r}catch(r){console.error("Error fetching claimed codes:",r)}}async function $(){try{const{data:r,error:t}=await n.from("promo_codes").select("*").eq("is_claimed",!1).order("created_at",{ascending:!1});if(t)throw t;y.value=r}catch(r){console.error("Error fetching available codes:",r)}}const P=b;return H(m,()=>{Promise.all([D(),$()])}),N(()=>{Promise.all([D(),$()])}),(r,t)=>{var C;return p(),g("div",te,[e("div",se,[t[10]||(t[10]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Coupon Statistics",-1)),e("div",oe,[e("nav",re,[(p(),g(B,null,R(k,a=>e("button",{key:a.value,onClick:F=>m.value=a.value,class:I(["px-3 py-2 text-sm font-medium border-b-2",s(m)===a.value?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},d(a.label),11,ae)),64))])]),e("div",ne,[e("div",ie,[t[6]||(t[6]=e("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"Business Starter",-1)),e("div",de,[e("div",le,[t[4]||(t[4]=e("span",{class:"text-sm text-gray-600"},"Available:",-1)),e("span",ce,d(_("starter",s(m))),1)]),e("div",ue,[t[5]||(t[5]=e("span",{class:"text-sm text-gray-600"},"Used:",-1)),e("span",me,d(o("starter",s(m))),1)])])]),e("div",xe,[t[9]||(t[9]=e("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"Business Standard",-1)),e("div",pe,[e("div",ge,[t[7]||(t[7]=e("span",{class:"text-sm text-gray-600"},"Available:",-1)),e("span",fe,d(_("standard",s(m))),1)]),e("div",ye,[t[8]||(t[8]=e("span",{class:"text-sm text-gray-600"},"Used:",-1)),e("span",be,d(o("standard",s(m))),1)])])])])]),s(c)?(p(),g("div",ve,[e("div",he,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Add New Promo Code",-1)),e("form",{onSubmit:W(S,["prevent"]),class:"space-y-4"},[e("div",_e,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Code Type",-1)),j(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>s(x).type=a),class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",required:""},t[11]||(t[11]=[e("option",{value:"starter"},"Business Starter",-1),e("option",{value:"standard"},"Business Standard",-1)]),512),[[z,s(x).type]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Region",-1)),j(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>s(x).region=a),class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",required:""},t[13]||(t[13]=[e("option",{value:"americas"},"Americas",-1),e("option",{value:"asia_pacific"},"Asia Pacific",-1),e("option",{value:"emea"},"EMEA",-1)]),512),[[z,s(x).region]])])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Promo Code",-1)),j(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>s(x).code=a),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",required:"",pattern:"[A-Z0-9]{15}",title:"Code must be 15 characters long and contain only uppercase letters and numbers"},null,512),[[L,s(x).code]])]),e("div",we,[e("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700",disabled:s(u)},d(s(u)?"Adding...":"Add Promo Code"),9,Ce)])],32)]),e("div",ke,[t[19]||(t[19]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Available Codes",-1)),e("div",Ae,[e("table",De,[t[18]||(t[18]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Code"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Region"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Created At"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1)),e("tbody",$e,[(p(!0),g(B,null,R(s(y),a=>(p(),g("tr",{key:a.id},[e("td",Me,d(a.code),1),e("td",Se,d(a.type),1),e("td",Ee,d(a.region),1),e("td",Pe,d(A(a.created_at)),1),e("td",je,[e("button",{onClick:F=>l(a),class:"text-red-600 hover:text-red-800",title:"Delete code"},t[17]||(t[17]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Ue)])]))),128))])])])])])):M("",!0),e("div",Be,[t[21]||(t[21]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Claimed Codes",-1)),e("div",Re,[e("table",Ve,[t[20]||(t[20]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Code"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Region"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Claimed By"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Claimed At")])],-1)),e("tbody",Te,[(p(!0),g(B,null,R(s(v),a=>(p(),g("tr",{key:a.id},[e("td",qe,d(a.promo_codes.code),1),e("td",Ne,d(a.type),1),e("td",ze,d(a.region),1),e("td",He,d(a.ip_address),1),e("td",Le,d(A(a.created_at)),1)]))),128))])])])]),s(w)?(p(),g("div",Oe,[e("div",Fe,[t[24]||(t[24]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Confirm Delete",-1)),e("p",Ie,[t[22]||(t[22]=T(" Are you sure you want to delete the promo code ")),e("span",We,d((C=s(h))==null?void 0:C.code),1),t[23]||(t[23]=T("? This action cannot be undone. "))]),e("div",Ge,[e("button",{onClick:t[3]||(t[3]=a=>w.value=!1),class:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-500"}," Cancel "),e("button",{onClick:E,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md"}," Delete ")])])])):M("",!0)])}}},Ze={class:"bg-white border border-gray-200 rounded-lg p-6"},Ke={class:"flex items-center justify-between mb-4"},Qe={class:"flex items-center space-x-2"},Xe=["disabled"],Ye={class:"mb-4"},et=["disabled"],tt={class:"flex justify-end space-x-3"},st=["disabled"],ot=`User-agent: *
Disallow: /admin
Disallow: /login

Sitemap: https://workspace-promos.netlify.app/sitemap.xml`,rt={__name:"RobotsEditor",emits:["saved"],setup(U,{emit:b}){const n=f(""),u=f(!1),v=b,y=q(()=>{const i=n.value;if(!i)return!1;const c=i.split(`
`),k=c.some(o=>o.trim().startsWith("User-agent:")),x=c.some(o=>o.trim().startsWith("Disallow:")),A=c.some(o=>o.trim()==="Disallow: /admin"),_=c.some(o=>o.trim()==="Disallow: /login");return k&&x&&A&&_});async function m(){try{const i=await fetch("/robots.txt");if(!i.ok)throw new Error("Failed to load robots.txt");n.value=await i.text()}catch(i){console.error("Error loading robots.txt:",i),v("saved","Error loading robots.txt","error")}}function w(){n.value=ot}async function h(){if(!y.value){v("saved","Invalid robots.txt content. Must include User-agent and Disallow directives for admin and login pages.","error");return}u.value=!0;try{const i=await fetch("/api/robots",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n.value})});if(!i.ok){const c=await i.json();throw new Error(c.message||"Failed to save robots.txt")}v("saved","robots.txt updated successfully")}catch(i){console.error("Error saving robots.txt:",i),v("saved",i.message||"Error saving robots.txt","error")}finally{u.value=!1}}return N(()=>{m()}),(i,c)=>(p(),g("div",Ze,[e("div",Ke,[c[1]||(c[1]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Edit robots.txt",-1)),e("div",Qe,[e("button",{onClick:w,class:"text-gray-600 hover:text-gray-800 text-sm",disabled:s(u)}," Reset to Default ",8,Xe)])]),e("div",Ye,[j(e("textarea",{"onUpdate:modelValue":c[0]||(c[0]=k=>G(n)?n.value=k:null),rows:"10",class:"w-full font-mono text-sm p-4 border border-gray-300 rounded-lg",disabled:s(u),placeholder:`User-agent: *
Disallow: /admin
Disallow: /login

Sitemap: https://your-site.com/sitemap.xml`},null,8,et),[[L,s(n)]]),c[2]||(c[2]=e("p",{class:"mt-2 text-sm text-gray-500"}," Make sure to include User-agent and Disallow directives, and keep the admin and login pages blocked from search engines. ",-1))]),e("div",tt,[e("button",{onClick:h,class:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 disabled:opacity-50",disabled:s(u)||!s(y)},d(s(u)?"Saving...":"Save Changes"),9,st)])]))}},at={class:"min-h-screen bg-white"},nt={class:"bg-white border-b border-gray-200"},it={class:"max-w-4xl mx-auto px-4"},dt={class:"flex justify-between h-14"},lt={class:"flex"},ct={class:"flex items-center space-x-4"},ut={key:0,class:"text-sm text-gray-700"},mt={class:"max-w-4xl mx-auto px-4 py-12"},xt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},pt={class:"bg-white border border-gray-200 p-6 rounded-lg"},gt={class:"text-2xl font-bold text-gray-900"},ft={class:"bg-white border border-gray-200 p-6 rounded-lg"},yt={class:"text-2xl font-bold text-gray-900"},bt={class:"bg-white border border-gray-200 p-6 rounded-lg"},vt={class:"text-2xl font-bold text-gray-900"},ht={key:1,class:"mt-8"},kt={__name:"index",setup(U){const b=O(),n=J(),u=Z(),v=f(!0),y=f({totalUsers:0,activePromoCodes:0,claimedCodes:0}),m=f({show:!1,message:"",type:"success"}),w=q(()=>{var o;return((o=n.value)==null?void 0:o.id)==="d38b6b3e-189c-47ce-b6a6-48187d160ebd"});async function h(){if(!n.value)return u.push("/login"),!1;try{const{data:o}=await b.from("admin_users").select().eq("user_id",n.value.id).single();return o?!0:(u.push("/login"),!1)}catch(o){return console.error("Error checking admin status:",o),u.push("/login"),!1}}function i(o,l="success"){m.value={show:!0,message:o,type:l},setTimeout(()=>{m.value.show=!1},5e3)}function c(){_(),i("Promo code added successfully")}function k(){_(),i("Promo code deleted successfully")}function x(o,l="success"){i(o,l)}async function A(){try{const{error:o}=await b.auth.signOut();if(o)throw o;u.push("/login")}catch(o){console.error("Error signing out:",o),i("Error signing out. Please try again.","error")}}async function _(){if(n.value)try{if(!await h())return;await b.from("admin_users").update({last_login:new Date().toISOString()}).eq("user_id",n.value.id);const[{count:l},{count:S},{count:E}]=await Promise.all([b.from("business_emails").select("id",{count:"exact"}),b.from("promo_codes").select("id",{count:"exact"}).eq("is_claimed",!1),b.from("user_claims").select("id",{count:"exact"})]);y.value={totalUsers:l||0,activePromoCodes:S||0,claimedCodes:E||0}}catch(o){console.error("Error fetching dashboard data:",o),i("Error fetching dashboard data","error")}finally{v.value=!1}}return H(n,o=>{o?_():u.push("/login")}),N(async()=>{await h()&&await _()}),K({title:"Admin Dashboard - Google Workspace Promo Codes",meta:[{name:"description",content:"Admin dashboard for managing Google Workspace promo codes and monitoring usage."}]}),(o,l)=>{var P;const S=Y,E=ee,D=Je,$=rt;return p(),g("div",at,[e("nav",nt,[e("div",it,[e("div",dt,[e("div",lt,[V(S,{to:"/",class:"flex items-center"},{default:Q(()=>l[0]||(l[0]=[e("svg",{class:"h-6 w-6 text-blue-400",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"})],-1)])),_:1})]),e("div",ct,[s(n)?(p(),g("span",ut,d(s(n).email),1)):M("",!0),s(n)?(p(),g("button",{key:1,onClick:A,class:"inline-flex items-center px-3 py-1 text-sm text-red-600 hover:text-red-700"},l[1]||(l[1]=[e("svg",{class:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),T(" Sign Out ")]))):M("",!0)])])])]),e("div",mt,[l[5]||(l[5]=e("div",{class:"text-center mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"Admin Dashboard"),e("p",{class:"text-gray-600"},"Manage promo codes and monitor usage")],-1)),s(m).show?(p(),X(E,{key:0,message:s(m).message,type:s(m).type},null,8,["message","type"])):M("",!0),e("div",xt,[e("div",pt,[l[2]||(l[2]=e("div",{class:"flex items-center justify-between mb-1"},[e("h3",{class:"text-sm font-medium text-gray-900"},"Total Users"),e("svg",{class:"h-5 w-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),e("p",gt,d(s(y).totalUsers),1)]),e("div",ft,[l[3]||(l[3]=e("div",{class:"flex items-center justify-between mb-1"},[e("h3",{class:"text-sm font-medium text-gray-900"},"Active Codes"),e("svg",{class:"h-5 w-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})])],-1)),e("p",yt,d(s(y).activePromoCodes),1)]),e("div",bt,[l[4]||(l[4]=e("div",{class:"flex items-center justify-between mb-1"},[e("h3",{class:"text-sm font-medium text-gray-900"},"Claimed Codes"),e("svg",{class:"h-5 w-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})])],-1)),e("p",vt,d(s(y).claimedCodes),1)])]),V(D,{onCodeAdded:c,onCodeDeleted:k,"user-id":(P=s(n))==null?void 0:P.id},null,8,["user-id"]),s(w)?(p(),g("div",ht,[V($,{onSaved:x})])):M("",!0)])])}}};export{kt as default};
